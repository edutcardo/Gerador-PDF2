<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário com Pesquisa</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
        background-color: #f9f9f9;
        color: #333;
        line-height: 1.6;
        display: flex;
        justify-content: center;
        align-items: flex-start; /* Altera de 'center' para 'flex-start' */
        height: 100vh;
        padding: 20px;
        overflow-y: auto; /* Adiciona rolagem vertical ao body */
    }

    .container {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        max-width: 500px;
        width: 100%;
        padding: 20px;
        /* Remove a restrição de altura fixa */
    }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #444;
        }

        label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }

        input[type="text"],
        input[type="email"],
        input[type="number"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        input[readonly] {
            background-color: #e9e9e9;
        }

        #resultados {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            max-height: 300px; /* Ajuste conforme necessário */
            overflow-y: auto;
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #f9f9f9;
        }

        .resultado-item {
            cursor: pointer;
            padding: 10px;
            background-color: #f1f1f1;
            border-radius: 4px;
            transition: background-color 0.3s;
            text-align: center;
        }

        .resultado-item:hover {
            background-color: #ddd;
        }

        button {
            width: 100%;
            padding: 10px;
            border: none;
            background-color: #007BFF;
            color: white;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Formulário de Usuário</h1>

        <form id="formulario">
            <label for="palavra-chave">Potência do Gerador:</label>
            <input type="text" id="palavra-chave" name="palavra-chave" oninput="buscarResultados()" />

            <label for="estrutura">Selecione uma Estrutura:</label>
            <select id="estrutura" name="estrutura" onchange="buscarResultados()">
                <option value="">Selecione uma estrutura</option>
                <option value="COLONIAL">COLONIAL</option>
                <option value="FIBROMADEIRA">FIBROMADEIRA</option>
                <option value="FIBROMETAL">FIBROMETAL</option>
                <option value="METALICO">METALICO</option>
                <option value="S/ESTRUTURA">S/ESTRUTURA</option>
            </select>
            


            <div id="resultados"></div>

            <label for="preco">Preço do Integrador:</label>
            <input type="text" id="preco" name="preco" readonly />

            <label for="nome">Nome:</label>
            <input type="text" id="nome" name="nome" />

            <label for="endereco">Endereço:</label>
            <input type="text" id="endereco" name="endereco" />

            <label for="cep">CEP:</label>
            <input type="text" id="cep" name="cep" oninput="buscarCidadePorCEP()" />

            <label for="cidade">Cidade:</label>
            <input type="text" id="cidade" name="cidade" readonly />

            <label for="uc">Unidade Consumidora:</label>
            <input type="text" id="uc" name="uc" />

            <label for="media">Média:</label>
            <input type="text" id="media" name="media" />

            <label for="numeroDeFases">Número de fases:</label>
            <select id="numeroDeFases" name="numeroDeFases">
                <option value="monofasico">MONOFÁSICO</option>
                <option value="bifasico">BIFÁSICO</option>
                <option value="trifasico">TRIFÁSICO</option>
                <option value="monoRural">MONO RURAL</option>
            </select>

            <label for="iluminacao">Iluminação:</label>
            <input type="text" id="iluminacao" name="iluminacao" />

            <label for="valor1">Valor 1:</label>
            <input type="number" id="valor1" name="valor1" />

            <label for="valor2">Valor 2:</label>
            <input type="number" id="valor2" name="valor2" />

            <!-- Adicionar os campos de entrada para as novas informações -->
            <label for="codProd">Código do Produto:</label>
            <input type="text" id="codProd" name="codProd" readonly />

            <label for="marca">Marca:</label>
            <input type="text" id="marca" name="marca" readonly />

            <label for="fabricante">Fabricante:</label>
            <input type="text" id="fabricante" name="fabricante" readonly />

            <label for="potenciaInversor">Potência do Inversor:</label>
            <input type="text" id="potenciaInversor" name="potenciaInversor" readonly />

            <label for="potenciaModulo">Potência do Módulo:</label>
            <input type="text" id="potenciaModulo" name="potenciaModulo" readonly />

            <label for="tensaoSaida">Tensão de Saída:</label>
            <input type="text" id="tensaoSaida" name="tensaoSaida" readonly />

            <label for="componentes">Componentes:</label>
            <input type="text" id="componentes" name="componentes" readonly />

            <label for="potenciaGerador">Potência do Gerador:</label>
            <input type="text" id="potenciaGerador" name="potenciaGerador" readonly />

            <button type="button" onclick="gerarPDF()">Gerar PDF</button>
        </form>
    </div>

    <script>
        function buscarResultados() {
            const potenciaGerador = document.getElementById('palavra-chave').value;
            const estrutura = document.getElementById('estrutura').value;
            
            // Verifica se há valores para buscar
            if (potenciaGerador.length > 0 || estrutura) {
                // Monta a URL com os parâmetros de busca
                let url = `buscar_preco.php?potencia-gerador=${encodeURIComponent(potenciaGerador)}`;
                if (estrutura) {
                    url += `&estrutura=${encodeURIComponent(estrutura)}`;
                }

                // Realiza a requisição para buscar os dados filtrados
                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        const resultadosDiv = document.getElementById('resultados');
                        resultadosDiv.innerHTML = '';  // Limpa resultados anteriores
                        if (data.success) {
                            data.resultados.slice(0, 10).forEach(item => { // Mostra até 10 resultados
                                const div = document.createElement('div');
                                div.className = 'resultado-item';
                                div.textContent = item.titulo;
                                div.onclick = () => selecionarItem(item);
                                resultadosDiv.appendChild(div);
                            });
                        } else {
                            resultadosDiv.innerHTML = 'Nenhum resultado encontrado';
                        }
                    })
                    .catch(error => console.error('Erro ao buscar resultados:', error));
            } else {
                // Limpa os resultados se não houver pesquisa
                document.getElementById('resultados').innerHTML = '';
                document.getElementById('preco').value = '';
            }
        }



        function selecionarItem(item) {
            // Preencher o campo de preço
            document.getElementById('preco').value = item.precoDoIntegrador;
            
            // Preencher os novos campos com as informações do item
            document.getElementById('codProd').value = item.codProd;
            document.getElementById('marca').value = item.marca;
            document.getElementById('fabricante').value = item.fabricante;
            document.getElementById('potenciaInversor').value = item.potenciaInversor;
            document.getElementById('potenciaModulo').value = item.potenciaModulo;
            document.getElementById('tensaoSaida').value = item.tensaoSaida;
            document.getElementById('componentes').value = item.componentes;
            document.getElementById('potenciaGerador').value = item.potenciaGerador;
            document.getElementById('numeroDeFases').value = item.numeroDeFases;
            
        }

        function gerarPDF() {
            const formData = new FormData(document.getElementById('formulario'));
                // Adiciona a constante potenciaGerador ao FormData
            const potenciaGerador = document.getElementById('potenciaGerador').value; // ou use a variável diretamente se já existir
            const potenciaModulo = document.getElementById('potenciaModulo').value;
            const precoKit = document.getElementById('preco').value;
            formData.append('potenciaGerador', potenciaGerador);
            formData.append('potenciaModulo', potenciaModulo);
            formData.append('precoKit', precoKit);
            
            fetch('gerar_pdf.php', {
                method: 'POST',
                body: formData
            })
                .then(response => response.blob())
                .then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = url;
                    a.download = 'arquivo_gerado.pdf';
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                })
                .catch(error => console.error('Erro ao gerar PDF:', error));
        }

        function preencherFormulario() {
            fetch('https://jsonplaceholder.typicode.com/users/1')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('nome').value = data.name;
                })
                .catch(error => {
                    console.log('Erro ao buscar dados da API:', error);
                });
        }

        window.onload = preencherFormulario;

        function buscarCidadePorCEP() {
            const cep = document.getElementById('cep').value;
            if (cep.length === 8) { // Valida se o CEP possui 8 dígitos
                fetch(`https://viacep.com.br/ws/${cep}/json/`)
                    .then(response => response.json())
                    .then(data => {
                        if (!data.erro) {
                            document.getElementById('cidade').value = data.localidade;
                        } else {
                            alert('CEP não encontrado!');
                            document.getElementById('cidade').value = '';
                        }
                    })
                    .catch(error => console.error('Erro ao buscar cidade pelo CEP:', error));
            }
        }

        window.onload = preencherFormulario;
    </script>
</body>
</html>